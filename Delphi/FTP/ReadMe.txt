 КПС "Обмен-данными" 
======================
Сервис взаимодействия с информационными системами координаторов эмиссии платежных карт.
Интегрирован в АПС "Лицевые счета". 

Сервис ТК-онлайн [mpk_service]
---------------------------------
Версия 3.0.0


1. Что нового
--------------
- Отчет по запросам о движении денежных средств на лицевом счете владельца 
  таможенной карты;
- Отчет по запросам о подтверждении уплаты таможенных пошлин, налогов;
- Изменена структура каталогов для хранения и обработки принимаемых файлов
  образов электронного чека и запросов к отчетам;
- Новые опции в INI-файле настроек сервиса;
- Новый лог-файл с более информативными сообщениями.


2.Основания для доработки
-------------------------
Технические условия взаимодействия между ФТС России и ООО "Мультисервисная платежная система"


3.Порядок установки и обновления
--------------------------------
Программа разработана для операционной системы Windows и работает в режиме
приложения - сервиса.

 Файлы, необходимые для работы:
 IAccFTP.exe    - исполняемый файл
 iaccftp.ini    - файл настроек программы
 nsi_import.ini - файл с информацией о структуре загружаемых данных

Поставляемая программа предназначена для замены старой версии "Сервиса ТК-онлайн"
(IaccFtpService), входящего в поставку АПС "Лицевые счета".

Чтобы произвести замену, необходимо выполнить следующие действия.
Остановить экземпляр "Сервиса ТК-онлайн", если последний работает.
Для этого необходимо открыть Панель управления,  перейти на вкладку Администрирование
и выбрать пункт Службы. В открывшемся списке служб найти  запись
"Сервис ТК-онлайн" [MPK_Service] (либо ИРС "Доход" - "Сервис ТК-онлайн" [IaccFtpService] для устаревших версий).
После двойного щелчка мышью по этой записи, появится диалоговое окно с параметрами службы.
Если служба работает, её необходимо остановить, нажав кнопку Стоп.
Тип запуска желательно установить в Отключено.

Удалить старый экземпляр "Сервиса ТК-онлайн"
Для проведения этой операции, необходимо запустить окно консольных приложений
(сеанс MS-DOS). В нём выполнить следующую команду
 sc delete iaccftpservice ( либо, в зависимости от версии, sc delete mpk_service )
при успешном выполнении команды будет выдано сообщение вида
 [SC] DeleteService SUCCESS

На место старого экземпляра записать новый экземпляр "Сервиса ТК-онлайн" (IAccFTP.ехе) и
файл настроек iaccftp.ini. Перед перезаписью рекомендуется сохранить копии старых файлов в
специальной директории (информация из файла iaccftp.ini может понадобиться).

Произвести настройку параметров в новом файле iaccftp.ini.
Все параметры в поставляемом файле снабжены комментариями и примерами и настроить
их не составит труда.

Зарегистрировать новый сервис в операционной системе Windows.
Для этого, находясь в окне консольных приложений, необходимо перейти в каталог,
где находится файл IAccFTP.ехе и выполнить команду
 iaccftp.exe /INSTALL .

Подробнее установка и настройка сервиса описаны в разделе 5.


4. Запуск и остановка
---------------------
Запуск "Сервиса ТК-онлайн" осуществляется через консоль управления службами операционной системы Windows.
В списке необходимо выбрать службу с именем "Сервис ТК-онлайн" [MPK_Service], и, если она не 
запущена, на инструментальной панели консоли управления службами нажать кнопку "Запуск службы".
Для остановки, необходимо, выбрав в списке службу "Сервис ТК-онлайн" [MPK_Service],
нажать кнопку "Остановка службы".


5. Подробное описание установки и настройки
-------------------------------------------

Сервис взаимодействия с информационными системами координаторов эмиссии платежных карт.
Интегрирован в АПС "Лицевые счета". 

Сервис ТК-онлайн "MPK_Service"

Подробная инструкция по установке и настройке.

Программа IAccFTP.exe предназначена для организации информационного взаимодействия
между операторами платежных систем, ЦИТТУ и таможенным органом путём обмена сформированными согласно регламенту
электронными документами используя протокол FTP сети Интернет и предоставляет следующие возможности:
- Сохранение сведений об операциях, связанных с уплатой таможенных платежей
с применением таможенных карт и формирование уведомлений о результате;
- Формирование документов с информацией о движении денежных
средств, уплаченных владельцами таможенных карт на счета таможенных органов
через сервис Личного кабинета участника ВЭД на Интернет-портале МПС согласно запросу.

  Программа разработана для операционной системы Windows и работает в режиме
приложения - сервиса.

 Файлы, необходимые для работы:
 IAccFTP.exe    - исполняемый файл
 iaccftp.ini    - файл настроек программы
 nsi_import.ini - файл с информацией о структуре загружаемых данных

Поставляемая программа предназначена для замены старой версии "Сервиса ТК-онлайн"
(IaccFtpService), входящего в поставку АПС "Лицевые счета".

Чтобы произвести замену, необходимо выполнить следующие действия.
Остановить экземпляр "Сервиса ТК-онлайн", если последний работает.
Для этого необходимо открыть Панель управления,  перейти на вкладку Администрирование
и выбрать пункт Службы. В открывшемся списке служб найти  запись
"Сервис ТК-онлайн" [MPK_Service] (либо ИРС "Доход" - "Сервис ТК-онлайн" [IaccFtpService] для устаревших версий).
После двойного щелчка мышью по этой записи, появится диалоговое окно с параметрами этой службы.
Если служба работает, её надо остановить, нажав кнопку Стоп. Тип запуска желательно установить в Отключено.

Удалить старый экземпляр "Сервиса ТК-онлайн"
Для проведения этой операции, необходимо запустить окно консольных приложений
(сеанс MS-DOS). В нём выполнить следующую команду:
  sc delete iaccftpservice (либо sc delete mpk_service для новых версий)
при успешном выполнении команды будет выдано сообщение вида
  [SC] DeleteService SUCCESS

На место старого экземпляра записать новый экземпляр "Сервиса ТК-онлайн" (IAccFTP.ехе) и
файл настроек iaccftp.ini. Перед перезаписью рекомендуется сохранить копии старых файлов в
специальной директории (информация из файла iaccftp.ini может понадобиться).

Произвести настройку параметров в файле iaccftp.ini.
Все параметры в поставляемом файле снабжены коментариями и примерами и настроить
их не составит труда.

Зарегистрировать новый сервис в операционной системе Windows.
Для этого, находясь в окне консольных приложений, необходимо перейти в каталог,
где находится файл IAccFTP.ехе и выполнить команду
   iaccftp.exe /INSTALL .

Запустить сервис.
Для этого необходимо открыть Панель управления, перейти на вкладку Администрирование
и выбрать пункт Службы. В открывшемся списке служб найти  запись
"Сервис ТК-онлайн" [MPK_Service].  После двойного щелчка мышью
по этой записи, появится диалоговое окно с параметрами этой службы.
Запустить службу можно нажав кнопку Пуск. Тип запуска установить
на В ручную или Автоматически.

Если всё проделано правильно, программа должна заработать.

Обращаем внимание, что в файле iaccftp.ini произошли изменния - добавились новые
параметры, необходимые для работы программы. Подробные пояснения к параметрам содержатся в
самом ini - файле.

Особое внимание требуется обратить на следующие параметры:

;путь в рабочий каталог
WorkDirPath=

; имя LOG - файла
LogFileName=

;максимальный размер LOG - файла, килобайт.
MaxLogSize=

;Путь к файлу информации о структуре загружаемых таблиц
NsiImportFile=

; количество платёжных систем с которыми осуществляется взаимодействие
ServiceCount=

;  интервал опроса ftp - серверов, секунд
PeriodSeconds=60


;Наименование сервиса
ServiceName=

;  === Локальные каталоги ===
;  каталог, куда загружаются файлы с транзакциями
DownLoadDir=

; Каталог в который копируются файлы с ошибочными транзакциями
ErrorFileDir=

; Каталог в котором формируются файлы ответа
AnswerDir=

; Архивный каталог, куда копируются файлы запросов, загруженные с FTP -  сервера
ArchDownDir=

; Архивный каталог, куда копируются файлы ответов, успешно выгруженные на FTP -  сервер
;  при DeleteFilesAfterImport <> 1
ArchAnswDir=

Для демонстракции возможностей программы предлагается ознакомиться с двумя вариантами
файла настроек  iaccftp.ini_sample - настройка для одного сервиса и
iaccftp.ini_2Serv_sample - настройка для двух сервисов. Выберете подходящий файл,
скопируйте его в тот же каталог, где находится IAccFTP.exe, переименуйте его в iaccftp.ini
и произведите настройку параметров.

Перед запуском, рекомендуется установить параметры программы следующим образом.
Первым делом необходимо настроить путь в рабочий каталог
Пример:
WorkDirPath==C:\Working\new_FTP\

Необходимо установить максимальный размер LOG - файла, в КИЛОБАЙТАХ.
MaxLogSize=250 - рекомендуемая величина

Необходимо указать путь к файлу информации о структуре загружаемых таблиц
( nsi_import.ini ) - этот файл входит в стандартную поставку АПС "Лицевые счета".
NsiImportFile=

Необходимо установить количество платёжных систем с которыми осуществляется взаимодействие
;ServiceCount=2
ServiceCount=1

Должен быть указан интервал опроса ftp - серверов, 60 секунд - стандартная величина
PeriodSeconds=60

Установить параметры подключения к базе данных
DBName=     - имя сервера
DBUserName= - имя пользователя
DBPassword= - пароль
На первых порах рекомендуем, что бы имя рабочей схемы совпадало с именем пользователя
DBSchema= - имя пользователя

Оставить пароль не зашифрованным
DBCrypt=0

Параметры настройки сервиса
[Service.0]
;Наименование сервиса
ServiceName=Операции уплаты с использованием Таможенной карты

;  === Локальные каталоги ===
Рекомендуется Пути к Локальным каталогам устанавливать относительными,
относительно WorkDirPath

;  каталог, куда загружаются файлы с запросами.
;Примеры относительного пути:
;DownLoadDir=Downloads_1
; или
;DownLoadDir=.\Downloads_1
Пример абсолютного пути
;DownLoadDir=C:\Downloads\new_FTP\Downloads_1

 Каталог в который копируются файлы с ошибочными запросами, примеры:
;ErrorFileDir=Errors_1
;ErrorFileDir=.\_Errors_1
;ErrorFileDir=C:\new_FTP\workDir\Errors_1

 Каталог в котором формируются файлы ответа, примеры:
;AnswerDir=Answers_1
;AnswerDir=  .\_Answers_1
;AnswerDir=C:\new_FTP\workDir\Answers
AnswerDir=

 Архивный каталог, куда копируются файлы запросов, загруженные с FTP -  сервера
;ArchDownDir=Downloads_1\ArchDownloads
ArchDownDir=

 Архивный каталог, куда копируются файлы ответов, успешно отправленные на FTP -  сервер
;  при DeleteFilesAfterImport <> 1
;ArchAnswDir= Answers_1\ArchAnswers
ArchAnswDir=

;  === Каталоги на удаленном FTP сервере ===
 каталоги на удаленном ftp сервере, из которого загружаются файлы с транзакциями
 установить в соответствие с требованиями  Протокола к Техническим условиям,
 пример:
SourceDir=IN

каталог на удаленном ftp сервере, в который отправляются файлы ответа
DestDir=OUT

  маска загружаемых с FTP файлов, пример:
FileMask=TK*.REQ

  маска выгружаемых файлов на FTP
AnswerMask=TK*.ANS

  максимальное количество единовременно загружаемых файлов с FTP - сервера
MaxTransactionCount = 25 - рекомендуемое значение

 ===  Ключи, рекомендуемые значения
DeleteFilesAfterImport=2

DeleteOldErrFiles=0

OverWriteExists=0

DeleteFtpFiles=1


[Service.0.FTP]
;  0 - активный режим
Passive=0

;  Имя FTP-сервера
Host=

;  порт (по умолчанию 21)
Port=21

;  имя пользователя на FTP
UserName=

;  пароль
FTPPassword=

;  0 - пароль не зашифрован
FTPCrpypt=0
